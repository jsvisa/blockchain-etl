networks:
  ethereum-net:
    driver: bridge

volumes:
  geth_data: {}
  tsdb_data: {}

services:
  geth:
    image: ethereum/client-go:v1.10.13
    container_name: geth
    volumes:
      - geth_data:/root
    command:
      - '--ropsten'
      - '--syncmode=full'
      - '--gcmode=archive'
      - '--cache.preimages'
      - '--cache.trie.rejournal=48h'
      - '--maxpeers=200'
      - '--pcscdpath='
      - '--snapshot=false'
      - '--port=30303'
      - '--http'
      - '--http.addr=0.0.0.0'
      - '--http.port=8545'
      - '--http.vhosts=*'
      - '--http.corsdomain=*'
      - '--http.api=web3,eth,net,personal,miner,txpool,debug,admin'
      - '--ws'
      - '--ws.addr=0.0.0.0'
      - '--ws.port=8546'
      - '--ws.origins=*'
      - '--ws.api=web3,eth,net,personal,miner,txpool,debug,admin'
      - '--metrics'
      - '--metrics.expensive'
      - '--metrics.addr=0.0.0.0'
      - '--metrics.port=6080'
      - '--pprof'
      - '--pprof.addr=0.0.0.0'
      - '--pprof.port=6081'
      - '--txlookuplimit=0'
    restart: unless-stopped
    ports:
      - '8545:8545'
      - '8546:8546'
      - '6080:6080'
      - '6081:6081'
    networks:
      - ethereum-net
    labels:
      org.label-schema.group: 'ethereum-geth'

  tsdb:
    image: timescale/timescaledb:2.10.0-pg15
    container_name: tsdb
    command:
      - 'postgres'
      - '-cshared_preload_libraries=pg_stat_statements'
      - '-cshared_preload_libraries=timescaledb'
      - '-cmax_connections=100'
    volumes:
      - tsdb_data:/var/lib/postgresql/data
    environment:
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD:-root}
    restart: unless-stopped
    ports:
      - '4432:5432'
    networks:
      - ethereum-net
    labels:
      org.label-schema.group: 'ethereum-geth'
